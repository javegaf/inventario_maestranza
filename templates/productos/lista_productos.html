{# templates/productos/lista_productos.html #}
{% extends 'base.html' %}
{% block title %}Listado de Productos{% endblock %}
{% block content %}
<h2>Listado de Productos</h2>

<div class="card mb-4">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-bordered table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Nombre</th>
                        <th>N° Serie</th>
                        <th>Ubicación</th>
                        <th>Categoría</th>
                        <th>Stock Actual</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for producto in productos %}
                    <tr class="{% if producto.is_blocked %}table-danger{% endif %}">
                        <td>{{ producto.nombre }}</td>
                        <td>{{ producto.numero_serie }}</td>
                        <td>{{ producto.ubicacion }}</td>
                        <td>{{ producto.categoria }}</td>
                        <td>{{ producto.stock_actual }}</td>
                        <td>
                            {% if producto.is_blocked %}
                                <span class="badge bg-danger">Bloqueado</span>
                            {% else %}
                                <span class="badge bg-success">Disponible</span>
                            {% endif %}
                        </td>
                        <td>
                            <button 
                                class="btn btn-sm {% if producto.is_blocked %}btn-success{% else %}btn-warning{% endif %} btn-toggle-block"
                                data-producto-id="{{ producto.id }}"
                                data-action="{% if producto.is_blocked %}unblock{% else %}block{% endif %}"
                                data-bs-toggle="modal" 
                                data-bs-target="#blockModal"
                            >
                                {% if producto.is_blocked %}
                                    <i class="bi bi-unlock"></i> Desbloquear
                                {% else %}
                                    <i class="bi bi-lock"></i> Bloquear
                                {% endif %}
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<a href="{% url 'crear_producto' %}" class="btn btn-success">
    <i class="bi bi-plus-circle"></i> Agregar nuevo producto
</a>

<a href="{% url 'historial_bloqueos' %}" class="btn btn-outline-info ms-2">
    <i class="bi bi-clock-history"></i> Ver historial de bloqueos
</a>

<!-- Modal for Block Reason -->
<div class="modal fade" id="blockModal" tabindex="-1" aria-labelledby="blockModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="blockModalLabel">Bloquear Producto</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="blockForm" method="post">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3" id="motivoGroup">
                        <label for="motivo" class="form-label">Motivo del bloqueo:</label>
                        <textarea class="form-control" id="motivo" name="motivo" rows="3" required></textarea>
                    </div>
                    <div class="alert alert-warning" id="unblockWarning" style="display:none;">
                        ¿Está seguro que desea desbloquear este producto?
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Confirmar</button>
                </div>
            </form>
        </div>
    </div>
</div>

{% load static %}
<script src="{% static 'js/blockproduct.js' %}"></script>
{% endblock %}